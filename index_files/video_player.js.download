;(function(window){'use strict';var videoObject;var allowedEvents={'kVideoReady':'ready','kVideoTimeUpdate':'timeupdate','kVideoPlay':'play','kVideoFirstPlay':'firstplay','kVideoComplete':'ended','kVideoFullscreen':'fullscreenchange','kVideoPlaylistItem':'playlistitem','kVideoNotWaiting':['playing','pause'],'kVideoWaiting':'waiting','kVideoVolumeChange':'volumechange'};function extend(a,b){for(var key in b){if(b.hasOwnProperty(key)){a[key]=b[key];}}
return a;}
function VideoPlayer(el,options){this.options=extend({},this.options);extend(this.options,options);this.currentTime=0;this.currentItem=0;this.player={};this.setContainerAndInit(el);}
VideoPlayer.prototype.setContainerAndInit=function(el){this.el=el;this.container=el;this.$container=$(this.container);this._init();};function applyEvents(self,allowedEvents,evt){self.player.on(allowedEvents[evt],function(ev){self.$container.trigger(evt);});}
VideoPlayer.prototype.options={template:'<video/>',classes:'video-js vjs-default-skin vjs-big-play-centered'};VideoPlayer.prototype.addEventListener=function(name,callback){if(allowedEvents.hasOwnProperty(name)){this.$container.on(name,callback.bind(this));}else{throw new Error('Event not allowed!');}};VideoPlayer.prototype.trigger=function(name){if(allowedEvents.hasOwnProperty(name)){this.$container.trigger(name);}else{throw new Error('Event not allowed!');}};VideoPlayer.prototype.removeEventListener=function(name,callback){if(allowedEvents.hasOwnProperty(name)){this.$container.off(name);}else{throw new Error('Event not allowed!');}};VideoPlayer.prototype.debounce=function(func,wait,immediate){var timeout;return function(){var context=this,args=arguments;var later=function(){timeout=null;if(!immediate)func.apply(context,args);};var callNow=immediate&&!timeout;clearTimeout(timeout);timeout=setTimeout(later,wait);if(callNow)func.apply(context,args);};};VideoPlayer.prototype._init=function(){var id=this.options.id,classes=this.options.classes;if(videoObject){videoObject.dispose();}
var template=$(this.options.template,{id:id,class:classes});if(this.options.audio){$(template).attr({'width':'100%','height':'30px'});}
if(this.options.skin){$(template).addClass(this.options.skin);}
$(this.container).html(template);this._createVideo(id);};VideoPlayer.prototype._createVideo=function(videoId){var self=this,options=this.options;videojs(videoId,options,function(){var playerWrapper=$(self.container).find('.video-js');self.player=videoObject=videojs(videoId);if(options.controls){$(playerWrapper).append('<div class="vjs-dock"/>');self.dock=$(playerWrapper).find('.vjs-dock');}
if(options.playlist){if(options.controls){if(options.audio){self._buildAudioPlaylist(options.playlist);}else{self._buildPlaylist(options.playlist);}}
self.playlist(options.playlist);}
self.setSocialShare(options.sharing);self._initEvents();});};VideoPlayer.prototype.setSocialShare=function(share){var self=this;self.options.sharing=share;if(self.options.sharing&&self.options.controls){self._buildSocialShare();self.socialShare();}else{$('.vjs-social-toggle',self.dock).remove();$('.vjs-social-container').remove();$(self.el).removeClass('vjs-social-open');}};VideoPlayer.prototype._buildPlaylist=function(playlist){var self=this,dock=self.dock,playerWrapper=$(self.container).find('.video-js');if(Object.keys(playlist).length>1){var playlistContainer=$('<div class="vjs-playlist-container"></div>');$(playlistContainer).append('<div class="vjs-playlist mCustomScrollBar"></div><button class="vjs-overlay-close"><i class="kartra-video-lineico-cross"></i></button>');$(playerWrapper).append(playlistContainer);$(dock).append('<button class="vjs-playlist-toggle"><span class="vjs-icon"><i class="kartra-video-lineico-list-2"></i></span></button>');$('.vjs-playlist-toggle',dock).tooltipster({theme:'tooltipster-light',touchDevices:true,position:'bottom',trigger:'hover',content:'Playlist'});}
self._setSpacing();};VideoPlayer.prototype._buildSocialShare=function(){var self=this,dock=self.dock,playerWrapper=$(self.container).find('.video-js'),socialContainer=$('<div class="vjs-social-container"></div>'),socialItems=['<div class="vjs-social">','<p>Share video</p>','<ul class="vjs-share-list">','<li><a class="fb_share_bottom" href="javascript:void(0)"><i class="kartra-video-lineico-facebook"></i></a></li>','<li><a class="tw_share_bottom" href="javascript:void(0)"><i class="kartra-video-lineico-twitter"></i></a></li>','<li><a class="li_share_bottom" href="javascript:void(0)"><i class="kartra-video-lineico-linkedin"></i></a></li>','</ul>','</div>'].join('');$(socialContainer).append('<button class="vjs-overlay-close"><i class="kartra-video-lineico-cross"></i></button>');$(socialContainer).append(socialItems);$(playerWrapper).append(socialContainer);$(dock).append('<button class="vjs-social-toggle" title="Share"><span class="vjs-icon"><i class="kartra-video-lineico-share"></i></span></button>');$('.vjs-social-toggle',dock).tooltipster({theme:'tooltipster-light',touchDevices:true,position:'bottom',trigger:'hover',content:'Share'});self._setSpacing();};VideoPlayer.prototype._buildAudioPlaylist=function(playlist){var self=this,playerWrapper=$(self.container);if(Object.keys(playlist).length>0){var audioPlaylistContainer=$('<div class="vjs-audio-playlist-container"></div>'),audioPlaylist=$('<ul class="vjs-audio-playlist"></ul>');for(var index=0;index<Object.keys(playlist).length;index++){var audioName=playlist[index].name.replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/"/g,"&quot;"),playlistItem='<li class="js_audio_playlist_item '+(index===0?'active':'')+'" id="audio_item_'+index+'" data-audio-item="'+index+'">'+
'<div class="vjs-text-wrapper">'+
'<a href="#" title="'+audioName+'">'+
'<span class="vjs-title">'+audioName+'</span>'+
'<span class="vjs-description">'+playlist[index].description+'</span>'+
'</a>'+
'</div>'+
'<div class="vjs-playlist-divider"></div>'+
'</li>';$(audioPlaylist).append(playlistItem);}
$(audioPlaylistContainer).html(audioPlaylist);$(playerWrapper).append(audioPlaylistContainer);}};VideoPlayer.prototype.buildWatermark=function(watermark){var self=this,playerWrapper=$(self.container).find('.video-js'),$watermarkStructure=$('<div class="vjs-watermark-container"></div>');$('.vjs-watermark-container',self.el).remove();if(typeof watermark!=='undefined'&&watermark!==''){var $watermarkImage=$('<img />');$watermarkImage.attr({src:watermark,class:'watermark_logo'});$watermarkStructure.append($watermarkImage);playerWrapper.append($watermarkStructure);}};VideoPlayer.prototype.setMutedAnimation=function(muted){var self=this;self.options.muted=muted;if(self.options.muted){self._buildMutedStructure();self.mutedAnimation();}else{$('.vjs-muted-container',self.el).remove();}};VideoPlayer.prototype._buildMutedStructure=function(){var self=this,playerWrapper=$(self.container).find('.video-js'),$mutedStructure=['<div class="vjs-muted-container">','<button class="vjs-muted-toggle"><span class="icon_holder"><i class="kartra-video-lineico-speaker_lvl_1"></i><i class="level_2"></i><i class="level_3"></i><i class="level_4"></i></span>Click for sound</button>','</div>'].join('');$(playerWrapper).append($mutedStructure);};VideoPlayer.prototype._setSpacing=function(){var self=this,dock=self.dock,dockButtons=$(dock).find('button'),playerWrapper=$(self.container).parent(),spacingClass='';if(dockButtons.length===1){spacingClass='with_single_button';}else{spacingClass='with_double_button';}
$(playerWrapper).removeClass('with_single_button with_double_button').addClass(spacingClass);};VideoPlayer.prototype._initEvents=function(){var self=this;for(var evt in allowedEvents){applyEvents(self,allowedEvents,evt);}};VideoPlayer.prototype.setSkin=function(skin){var self=this,playerElement=self.player.el();$(playerElement).removeClass(function(index,css){return(css.match(/(^|\s)kartra-vjs-skin-\S+/g)||[]).join(' ');});this.options.skin=skin;$(playerElement).addClass(skin);};VideoPlayer.prototype.setSource=function(source){var self=this,sources=[{src:source,type:'video/mp4'}];self.player.src(sources);this.options.sources=sources;self.player.load();};VideoPlayer.prototype.setSplashPoster=function(splash_url){var self=this;self.player.poster(splash_url);this.options.poster=splash_url;self.player.load();};VideoPlayer.prototype.setCurrentItem=function(){this.currentItem=this.player.playlist.currentItem();};VideoPlayer.prototype.setCurrentTime=function(){this.currentTime=this.player.currentTime();};VideoPlayer.prototype.setVideoToSecond=function(second){this.player.currentTime(second);};VideoPlayer.prototype.setControls=function(state){this.player.controls(state);this.options.controls=state;};VideoPlayer.prototype.displayPlaybackRates=function(state){this.player.playbackRate(0);this.player.playbackRate(1);if(true===state){this.player.controlBar.playbackRateMenuButton.show();}else{this.player.controlBar.playbackRateMenuButton.hide();}}
VideoPlayer.prototype.mute=function(state){this.player.muted(state);};VideoPlayer.prototype.play=function(state){this.player[state===true?'play':'pause']();};VideoPlayer.prototype.setDimensions=function(width,height){this.player.dimensions(width,height);this.player.aspectRatio(width+':'+height);};VideoPlayer.prototype.setPlaylistRepeat=function(state){this.player.playlist.repeat(state);};VideoPlayer.prototype.exitFullscreen=function(){this.player.exitFullscreen();};VideoPlayer.prototype.isFullscreen=function(){var state=false;if(this.player.isFullscreen()){state=true;}
return state;};VideoPlayer.prototype.isPlaying=function(){var state=true;if(this.player.paused()===true){state=false;}
return state;};VideoPlayer.prototype.isReady=function(){var ready=false;if(this.player.readyState()>0){ready=true;}
return ready;};VideoPlayer.prototype.isWaiting=function(){var state=false;if(this.player.waiting()===true){state=true;}
return state;};VideoPlayer.prototype.isLastPlaylistItem=function(){var playlist=this.player.playlist(),currentItemIndex=this.player.playlist.currentItem(),lastItem=playlist[Object.keys(playlist)[Object.keys(playlist).length-1]],lastItemIndex=this.player.playlist.indexOf(lastItem),state=false;if(currentItemIndex===lastItemIndex){state=true;}
return state;};VideoPlayer.prototype.playlist=function(playlist){var self=this,dock=self.dock,options=this.options,playlistContainer=$(this.el);this.player.playlist(playlist);this.player.playlist.autoadvance(0);if(options.playlist_repeat){this.player.playlist.repeat(true);}
if(!options.audio){this.player.playlistUi();var playingFlag=true;var playlistOpenBtn=$(dock).find('.vjs-playlist-toggle');$(playlistOpenBtn).on('click',function(e){e.stopPropagation();$(this).tooltipster('hide');$(playlistContainer).addClass('vjs-playlist-open');if(self.isPlaying()){playingFlag=false;self.player.pause();}});var playlistCloseBtn=$(playlistContainer).find('.vjs-overlay-close');$(playlistCloseBtn).on('click',function(e){e.stopPropagation();$(playlistContainer).removeClass('vjs-playlist-open');if(!playingFlag){self.player.play();playingFlag=true;}});self.player.on('playlistitem',function(e){self.player.play();if($(playlistContainer).hasClass('vjs-playlist-open')){$(playlistContainer).removeClass('vjs-playlist-open');}});}else{$(playlistContainer).on('click','.js_audio_playlist_item',function(e){e.stopPropagation();var audioItem=$(this).data('audio-item');$(playlistContainer).find('.js_audio_playlist_item').removeClass('active');$(this).addClass('active');self.player.playlist.currentItem(audioItem);if(!playingFlag){self.player.play();}});self.player.on('playlistitem',function(e){var audioItem=self.player.playlist.currentItem();$(playlistContainer).find('.js_audio_playlist_item').removeClass('active');$(playlistContainer).find('.js_audio_playlist_item[data-audio-item="'+audioItem+'"]').addClass('active');});}};VideoPlayer.prototype.socialShare=function(playlist){var self=this,dock=self.dock,socialContainer=$(this.el);var playingFlag=true;var socialOpenBtn=$(dock).find('.vjs-social-toggle');$(socialOpenBtn).on('click',function(e){e.stopPropagation();$(this).tooltipster('hide');$(socialContainer).addClass('vjs-social-open');if(self.isPlaying()){playingFlag=false;self.player.pause();}});var socialCloseBtn=$(socialContainer).find('.vjs-overlay-close');$(socialCloseBtn).on('click',function(e){e.stopPropagation();$(socialContainer).removeClass('vjs-social-open');if(!playingFlag){self.player.play();playingFlag=true;}});};VideoPlayer.prototype.mutedAnimation=function(){var self=this,$videoContainer=$(self.el),$mutedContainer=$('.vjs-muted-container',$videoContainer),$muteToggle=$('.vjs-muted-toggle',$mutedContainer);$muteToggle.on('click',function(e){var isMuted=self.player.muted();e.stopPropagation();if(isMuted){self.mute(false);self.options.muted=false;$mutedContainer.remove();}else{self.options.muted=true;$mutedContainer.remove();}});self.player.on('volumechange',function(e){var volume=self.player.volume();if(volume!==0){self.options.muted=false;$mutedContainer.remove();}});};VideoPlayer.prototype.displayTextTracks=function(textTrack){this.player.addRemoteTextTrack({src:textTrack,kind:'captions',label:'captions on',mode:'showing'},false);$('.vjs-texttrack-settings').css('display','none');}
VideoPlayer.prototype.removeTextTracks=function(){var tracks=this.player.remoteTextTracks(),i=tracks.length-1;for(i;i>=0;i--){this.player.removeRemoteTextTrack(tracks[i]);}}
window.VideoPlayer=VideoPlayer;})(window);